format_version: 1.3.1
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  - BITRISE_PROJECT_PATH: Multiplatform.sln
  
workflows:
  ios-uitest:
    envs:
    - BITRISE_XAMARIN_CONFIGURATION: Debug
    - BITRISE_XAMARIN_PLATFORM: iPhoneSimulator
    - TEST_TO_RUN: Multiplatform.UItest.Tests(iOS)
    steps:
    - git-clone:
    - certificate-and-profile-installer:
    - nuget-restore:
    - xamarin-archive:
        inputs:
        - project_type_whitelist: ios
    - xamarin-ios-test:
        inputs:
        - test_to_run: $TEST_TO_RUN

  calabash:
    envs:
    - BITRISE_XAMARIN_CONFIGURATION: calabash
    - BITRISE_XAMARIN_PLATFORM: Any CPU
    - BITRISE_EMULATOR_NAME: Emulator
    steps:
    - git-clone:
    - certificate-and-profile-installer:
    - nuget-restore:
    - xamarin-archive:
        inputs:
        - project_type_whitelist: android,ios
    - calabash-ios-uitest:
        inputs:
        - work_dir: iOS
    - create-android-emulator:
        run_if: .IsCI
        inputs:
        - name: $BITRISE_EMULATOR_NAME
    - start-android-emulator:
    - calabash-android-uitest:
        inputs:
        - work_dir: Droid
    - deploy-to-bitrise-io:
